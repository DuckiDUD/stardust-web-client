"use strict";(self.webpackChunkstardust=self.webpackChunkstardust||[]).push([[716],{200:(t,s,e)=>{e.d(s,{R:()=>a});var i=e(112);class a{constructor(t){this.Ca=t}Bb(){(0,i.i)(this.ca)&&this.Oe()}ra(){(0,i.a)(this.ca)&&window.cancelAnimationFrame(this.ca),this.ca=void 0}Oe(){this.ca=window.requestAnimationFrame((()=>{(0,i.i)(this.ca)||(this.Ca(),this.Oe())}))}}},716:(t,s,e)=>{e.r(s),e.d(s,{GoogleCastProvider:()=>m});var i=e(112),a=e(168),r=e(200),n=e(256),h=e(720);class o{constructor(t){this.Ul=new chrome.cast.media.MediaInfo(t.src,t.type)}build(){return this.Ul}Xl(t){return t.includes("live")?this.Ul.streamType=chrome.cast.media.StreamType.LIVE:this.Ul.streamType=chrome.cast.media.StreamType.BUFFERED,this}Yl(t){return this.Ul.tracks=t.map(this.Il),this}Zl(t,s){return this.Ul.metadata=new chrome.cast.media.GenericMediaMetadata,this.Ul.metadata.title=t,this.Ul.metadata.images=[{url:s}],this}Il(t,s){const e=new chrome.cast.media.Track(s,chrome.cast.media.TrackType.TEXT);return e.name=t.label,e.trackContentId=t.src,e.trackContentType="text/vtt",e.language=t.language,e.subtype=t.kind.toUpperCase(),e}}const c=chrome.cast.media.TrackType.TEXT,l=chrome.cast.media.TrackType.AUDIO;class d{constructor(t,s,e){this.xm=t,this.b=s,this.zm=e}Hm(){const t=this.Km.bind(this);(0,i.l)(this.b.audioTracks,"change",t),(0,i.l)(this.b.textTracks,"mode-change",t),(0,i.e)(this.Lm.bind(this))}wm(){return this.b.$state.textTracks().filter((t=>t.src&&"vtt"===t.type))}Cm(){return this.b.$state.audioTracks()}Wl(t){var s,e;const i=null!==(s=null===(e=this.xm.mediaInfo)||void 0===e?void 0:e.tracks)&&void 0!==s?s:[];return t?i.filter((s=>s.type===t)):i}Dm(){const t=[],s=this.Cm().find((t=>t.selected)),e=this.wm().filter((t=>"showing"===t.mode));if(s){const e=this.Wl(l),i=this.ym(e,s);i&&t.push(i.trackId)}if(null!==e&&void 0!==e&&e.length){const s=this.Wl(c);if(s.length)for(const i of e){const e=this.ym(s,i);e&&t.push(e.trackId)}}return t}Lm(){const t=this.wm();if(!this.xm.isMediaLoaded)return;const s=this.Wl(c);for(const e of t){if(!this.ym(s,e)){(0,i.O)((()=>{var t;return null===(t=this.zm)||void 0===t?void 0:t.call(this)}));break}}}Mm(t){if(!this.xm.isMediaLoaded)return;const s=this.Cm(),e=this.wm(),i=this.Wl(l),a=this.Wl(c);for(const h of i){var r;if(this.Em(s,h))continue;const e={id:h.trackId.toString(),label:h.name,language:h.language,kind:null!==(r=h.subtype)&&void 0!==r?r:"main",selected:!1};this.b.audioTracks[n.L.oa](e,t)}for(const n of a){if(this.Em(e,n))continue;const s={id:n.trackId.toString(),src:n.trackContentId,label:n.name,language:n.language,kind:n.subtype.toLowerCase()};this.b.textTracks.add(s,t)}}Km(t){if(!this.xm.isMediaLoaded)return;const s=this.Dm(),e=new chrome.cast.media.EditTracksInfoRequest(s);this.Jm(e).catch((t=>{}))}Jm(t){const s=(0,h.f)();return new Promise(((e,i)=>null===s||void 0===s?void 0:s.editTracksInfo(t,e,i)))}Em(t,s){return t.find((t=>this.Fm(t,s)))}ym(t,s){return t.find((t=>this.Fm(s,t)))}Fm(t,s){return s.name===t.label&&s.language===t.language&&s.subtype.toLowerCase()===t.kind.toLowerCase()}}class m{constructor(t,s){this.aa=t,this.b=s,this.$$PROVIDER_TYPE="GOOGLE_CAST",this.scope=(0,i.x)(),this.V=null,this.mc="disconnected",this.Va=0,this.Fa=0,this.Ga=new a.T(0,0),this.Hb=new a.T(0,0),this.Da=new r.R(this.bd.bind(this)),this.vm=null,this.Am=!1,this.yb=new d(this.aa,this.b,this.zm.bind(this))}get c(){return this.b.delegate.c}get type(){return"google-cast"}get currentSrc(){return this.V}get player(){return this.aa}get cast(){return(0,h.g)()}get session(){return(0,h.a)()}get media(){return(0,h.f)()}get hasActiveSession(){return(0,h.j)(this.V)}setup(){this.sm(),this.tm(),this.yb.Hm(),this.c("provider-setup",this)}sm(){(0,h.l)(cast.framework.CastContextEventType.CAST_STATE_CHANGED,this.qm.bind(this))}tm(){const t=cast.framework.RemotePlayerEventType,s={[t.IS_CONNECTED_CHANGED]:this.qm,[t.IS_MEDIA_LOADED_CHANGED]:this.Jl,[t.CAN_CONTROL_VOLUME_CHANGED]:this.em,[t.CAN_SEEK_CHANGED]:this.fm,[t.DURATION_CHANGED]:this.wg,[t.IS_MUTED_CHANGED]:this.ab,[t.VOLUME_LEVEL_CHANGED]:this.ab,[t.IS_PAUSED_CHANGED]:this.jm,[t.LIVE_SEEKABLE_RANGE_CHANGED]:this.ic,[t.PLAYER_STATE_CHANGED]:this.km};this.dm=s;const e=this.lm.bind(this);for(const a of(0,i.P)(s))this.aa.controller.addEventListener(a,e);(0,i.o)((()=>{for(const t of(0,i.P)(s))this.aa.controller.removeEventListener(t,e)}))}async play(){var t;(this.aa.isPaused||this.Am)&&(this.Am?await this.Gm(!1,0):null===(t=this.aa.controller)||void 0===t||t.playOrPause())}async pause(){var t;this.aa.isPaused||null===(t=this.aa.controller)||void 0===t||t.playOrPause()}getMediaStatus(t){return new Promise(((s,e)=>{var i;null===(i=this.media)||void 0===i||i.getStatus(t,s,e)}))}setMuted(t){var s;(t&&!this.aa.isMuted||!t&&this.aa.isMuted)&&(null===(s=this.aa.controller)||void 0===s||s.muteOrUnmute())}setCurrentTime(t){var s;this.aa.currentTime=t,this.c("seeking",t),null===(s=this.aa.controller)||void 0===s||s.seek()}setVolume(t){var s;this.aa.volumeLevel=t,null===(s=this.aa.controller)||void 0===s||s.setVolumeLevel()}async loadSource(t){var s;if((null===(s=this.vm)||void 0===s?void 0:s.src)!==t&&(this.vm=null),(0,h.j)(t))return this.um(),void(this.V=t);this.c("load-start");const e=this.am(t),i=await this.session.loadMedia(e);if(i)return this.V=null,void this.c("error",Error((0,h.c)(i)));this.V=t}destroy(){this.H(),this.rm()}H(){this.vm||(this.Fa=0,this.Ga=new a.T(0,0),this.Hb=new a.T(0,0)),this.Da.ra(),this.Va=0,this.vm=null}um(){var t,s,e;const a=new i.D("resume-session",{detail:this.session});this.Jl(a);const{muted:r,volume:n,remotePlaybackInfo:h}=this.b.$state,o=h();this.setCurrentTime(Math.max(this.aa.currentTime,null!==(t=null===o||void 0===o||null===(s=o.savedState)||void 0===s?void 0:s.currentTime)&&void 0!==t?t:0)),this.setMuted(r()),this.setVolume(n()),!1===(null===o||void 0===o||null===(e=o.savedState)||void 0===e?void 0:e.paused)&&this.play()}rm(){this.cast.endCurrentSession(!0);const{remotePlaybackLoader:t}=this.b.$state;t.set(null)}Ml(){this.b.$state.remotePlaybackInfo.set({savedState:{paused:this.aa.isPaused,currentTime:this.aa.currentTime}}),this.rm()}bd(){this.im()}lm(t){this.dm[t.type].call(this,t)}qm(t){const s=this.cast.getCastState(),e=s===cast.framework.CastState.CONNECTED?"connected":s===cast.framework.CastState.CONNECTING?"connecting":"disconnected";if(this.mc===e)return;const i={type:"google-cast",state:e},a=this.Vl(t);this.mc=e,this.c("remote-playback-change",i,a),"disconnected"===e&&this.Ml()}Jl(t){if(!!!this.aa.isMediaLoaded)return;const s=(0,i.u)(this.b.$state.source);Promise.resolve().then((()=>{if(s!==(0,i.u)(this.b.$state.source)||!this.aa.isMediaLoaded)return;this.H();const e=this.aa.duration;this.Hb=new a.T(0,e);const r={provider:this,duration:e,buffered:this.Ga,seekable:this.gm()},n=this.Vl(t);this.c("loaded-metadata",void 0,n),this.c("loaded-data",void 0,n),this.c("can-play",r,n),this.em(),this.fm(t);const{volume:h,muted:o}=this.b.$state;this.setVolume(h()),this.setMuted(o()),this.Da.Bb(),this.yb.Mm(n),this.yb.Km(n)}))}em(){this.b.$state.canSetVolume.set(this.aa.canControlVolume)}fm(t){const s=this.Vl(t);this.c("stream-type-change",this.mm(),s)}mm(){var t;return(null===(t=this.aa.mediaInfo)||void 0===t?void 0:t.streamType)===chrome.cast.media.StreamType.LIVE?this.aa.canSeek?"live:dvr":"live":"on-demand"}im(){if(this.vm)return;const t=this.aa.currentTime;if(t===this.Va)return;const s=this.Fa,e={currentTime:t,played:this.cm(t)};this.c("time-update",e),t>s&&this.ic(),this.b.$state.seeking()&&this.c("seeked",t),this.Va=t}cm(t){return this.Fa>=t?this.Ga:this.Ga=new a.T(0,this.Fa=t)}wg(t){if(!this.aa.isMediaLoaded||this.vm)return;const s=this.aa.duration,e=this.Vl(t);this.Hb=new a.T(0,s),this.c("duration-change",s,e)}ab(t){if(!this.aa.isMediaLoaded)return;const s={muted:this.aa.isMuted,volume:this.aa.volumeLevel},e=this.Vl(t);this.c("volume-change",s,e)}jm(t){const s=this.Vl(t);this.aa.isPaused?this.c("pause",void 0,s):this.c("play",void 0,s)}ic(t){const s={seekable:this.gm(),buffered:this.Ga},e=t?this.Vl(t):void 0;this.c("progress",s,e)}km(t){const s=this.aa.playerState,e=chrome.cast.media.PlayerState;if(this.Am=s===e.IDLE,s===e.PAUSED)return;const i=this.Vl(t);switch(s){case e.PLAYING:this.c("playing",void 0,i);break;case e.BUFFERING:this.c("waiting",void 0,i);break;case e.IDLE:this.Da.ra(),this.c("pause"),this.c("end")}}gm(){return this.aa.liveSeekableRange?new a.T(this.aa.liveSeekableRange.start,this.aa.liveSeekableRange.end):this.Hb}Vl(t){return t instanceof Event?t:new i.D(t.type,{detail:t})}Dl(t){const{streamType:s,title:e,poster:i}=this.b.$state;return new o(t).Zl(e(),i()).Xl(s()).Yl(this.yb.wm()).build()}am(t){var s,e,i,a,r,n,h;const o=this.Dl(t),c=new chrome.cast.media.LoadRequest(o),l=this.b.$state.remotePlaybackInfo();return c.autoplay=!1===(null!==(s=null===(e=this.vm)||void 0===e?void 0:e.paused)&&void 0!==s?s:null===l||void 0===l||null===(i=l.savedState)||void 0===i?void 0:i.paused),c.currentTime=null!==(a=null!==(r=null===(n=this.vm)||void 0===n?void 0:n.time)&&void 0!==r?r:null===l||void 0===l||null===(h=l.savedState)||void 0===h?void 0:h.currentTime)&&void 0!==a?a:0,c}async Gm(t,s){const e=(0,i.u)(this.b.$state.source);this.vm={src:e,paused:t,time:s},await this.loadSource(e)}zm(){this.Gm(this.aa.isPaused,this.aa.currentTime).catch((t=>{}))}}}}]);
//# sourceMappingURL=716.fe42401f.chunk.js.map